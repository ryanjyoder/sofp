name: sofp
version: '0.0.1'
summary: A (S)tack (O)ver(f)low (P)arser
description: SOFP downloads and parses the archives hosted at https://archive.org/details/stackexchange.
grade: stable
confinement: strict
base: core


apps:
  downloader:
    command: bin/run_downloader
    daemon: simple
    # run every hour (24 times per day)
    timer: 00:00-24:00/24 
    plugs: [network, removable-media]
  lookupbuilder:
    command: bin/run_lookupbuilder
    daemon: simple
    # run every hour (24 times per day)
    timer: 00:00-24:00/24 
    plugs: [removable-media]
#  api:
#    command: bin/api $SNAP_COMMON
#    daemon: simple
#    plugs: [network, network-bind]
#  templater:
#    command: bin/templater $SNAP_COMMON $SNAP/template
#    daemon: simple
#    plugs: [network, network-bind]

  

parts:
  sofp:
    source: .
    plugin: go
    go-packages: ["github.com/ryanjyoder/sofp/cmd/downloader"]
    stage-packages:
      - p7zip-full
    build-packages:
      - git
      - gcc
    override-build: |
      export GO111MODULE=on
      go get -u gopkg.in/go-playground/assert.v1
      echo _______________________ Building binaries _______________________________
      go build cmd/downloader/downloader.go
      go build cmd/lookupbuilder/lookupbuilder.go
      #go build cmd/api/api.go
      #go build cmd/templater/templater.go
      echo _______________________ Build finished ________________________________
      mkdir  -p $SNAPCRAFT_PART_INSTALL/bin
      cp downloader $SNAPCRAFT_PART_INSTALL/bin/
      cp lookupbuilder $SNAPCRAFT_PART_INSTALL/bin/
      #cp api $SNAPCRAFT_PART_INSTALL/bin/
      #cp templater $SNAPCRAFT_PART_INSTALL/bin/
      cp bin/run_downloader $SNAPCRAFT_PART_INSTALL/bin/
      cp bin/run_lookupbuilder $SNAPCRAFT_PART_INSTALL/bin/ 
      cp bin/7z $SNAPCRAFT_PART_INSTALL/bin/
      echo _______________________ Building finished ___________________________

  template:
    source: .
    plugin: dump
    stage: 
      - template
